<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AdminCore Cloud</title>
    
    <!-- Configuración PWA -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4f46e5">
    <link rel="manifest" href='data:application/json,{"name":"AdminCore Cloud","short_name":"AdminCore","start_url":"/","display":"standalone","background_color":"#4f46e5","theme_color":"#4f46e5","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/3658/3658257.png","sizes":"512x512","type":"image/png"}]}'>

    <!-- Estilos y Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            GoogleAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // --- TUS CREDENCIALES INTEGRADAS ---
        const firebaseConfig = {
            apiKey: "AIzaSyA8YJqgIPcruAlkuB99zIwXoWcLgc75bn0",
            authDomain: "admincore-b5f77.firebaseapp.com",
            projectId: "admincore-b5f77",
            storageBucket: "admincore-b5f77.firebasestorage.app",
            messagingSenderId: "992365412952",
            appId: "1:992365412952:web:22d36926b1680798aa802d",
            measurementId: "G-WEYK7WE665"
        };

        // Inicialización de servicios
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        auth.languageCode = 'es';

        let currentUser = null;

        // --- MANEJO DE AUTENTICACIÓN ---
        window.loginWithGoogle = () => {
            signInWithPopup(auth, provider)
                .then((result) => {
                    showToast("¡Bienvenido, " + result.user.displayName + "!");
                })
                .catch((error) => {
                    console.error(error);
                    showToast("Error al entrar. Revisa los dominios autorizados en Firebase.");
                });
        };

        window.logout = () => {
            signOut(auth).then(() => {
                showToast("Sesión cerrada");
            });
        };

        onAuthStateChanged(auth, async (user) => {
            const loginUI = document.getElementById('auth-screen');
            const mainUI = document.getElementById('app-screen');
            
            if (user) {
                currentUser = user;
                document.getElementById('user-img').src = user.photoURL;
                document.getElementById('user-name').innerText = user.displayName;
                loginUI.classList.add('hidden');
                mainUI.classList.remove('hidden');
                await loadCloudSettings();
                lucide.createIcons();
            } else {
                currentUser = null;
                loginUI.classList.remove('hidden');
                mainUI.classList.add('hidden');
            }
        });

        // --- MANEJO DE FIRESTORE ---
        async function loadCloudSettings() {
            if (!currentUser) return;
            try {
                const docRef = doc(db, "users", currentUser.uid);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('url-prices').value = data.pricesUrl || "";
                    document.getElementById('url-products').value = data.productsUrl || "";
                }
            } catch (e) {
                console.error("Error cargando Firestore:", e);
            }
        }

        window.saveSettings = async () => {
            if (!currentUser) return;
            const btn = document.getElementById('btn-save');
            btn.innerText = "Guardando...";
            try {
                await setDoc(doc(db, "users", currentUser.uid), {
                    pricesUrl: document.getElementById('url-prices').value,
                    productsUrl: document.getElementById('url-products').value,
                    updatedAt: new Date()
                });
                showToast("Sincronizado con éxito");
            } catch (e) {
                showToast("Error al guardar: Activa Firestore en modo prueba");
                console.error(e);
            } finally {
                btn.innerText = "Guardar en mi Perfil";
            }
        };

        // --- ENVÍO DE DATOS A WEBHOOKS ---
        window.sendToWebhook = async (type) => {
            const pricesUrl = document.getElementById('url-prices').value;
            const productsUrl = document.getElementById('url-products').value;
            const targetUrl = type === 'prices' ? pricesUrl : productsUrl;

            if (!targetUrl) {
                showToast("Configura la URL en la pestaña Config");
                return;
            }

            let data = (type === 'prices') ? {
                tipo: "Precios",
                usuario: currentUser.email,
                proveedor: document.getElementById('p-prov').value,
                lista: document.getElementById('p-list').value
            } : {
                tipo: "Producto",
                usuario: currentUser.email,
                nombre: document.getElementById('pr-name').value,
                precio: document.getElementById('pr-cost').value
            };

            showToast("Enviando...");
            try {
                await fetch(targetUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(data)
                });
                showToast("¡Enviado!");
                if(type === 'prices') document.getElementById('p-list').value = "";
                else { document.getElementById('pr-name').value = ""; document.getElementById('pr-cost').value = ""; }
            } catch (err) {
                showToast("Error de conexión");
            }
        };

        window.showToast = (msg) => {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 3000);
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .tab-content { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- LOGIN -->
    <div id="auth-screen" class="min-h-screen flex items-center justify-center p-6 bg-slate-950">
        <div class="w-full max-w-md bg-white p-12 rounded-[3rem] shadow-2xl text-center border-t-4 border-indigo-600">
            <div class="bg-indigo-600 w-20 h-20 rounded-3xl flex items-center justify-center text-white mx-auto mb-8 shadow-2xl">
                <i data-lucide="shield-check" size="40"></i>
            </div>
            <h1 class="text-3xl font-black mb-3 italic tracking-tighter">AdminCore Cloud</h1>
            <p class="text-slate-500 mb-10 font-medium">Logística Inteligente</p>
            <button onclick="loginWithGoogle()" class="w-full py-4 bg-white border-2 border-slate-100 rounded-2xl font-bold flex items-center justify-center gap-3 hover:bg-slate-50 active:scale-95 transition-all shadow-sm">
                <img src="https://www.gstatic.com/images/branding/product/1x/gsa_512dp.png" class="w-6" alt="Google">
                Entrar con Google
            </button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app-screen" class="hidden min-h-screen pb-10">
        <div id="toast" class="fixed top-8 left-1/2 -translate-x-1/2 z-[100] hidden">
            <div class="bg-slate-800 text-white px-6 py-3 rounded-2xl font-bold shadow-2xl flex items-center gap-3 border border-slate-700">
                <i data-lucide="info" size="18"></i> <span id="toast-msg"></span>
            </div>
        </div>

        <header class="p-6 flex items-center justify-between bg-white border-b sticky top-0 z-40">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-600 p-2 rounded-xl text-white shadow-lg"><i data-lucide="activity" size="20"></i></div>
                <span class="font-black text-xl tracking-tighter">AdminCore</span>
            </div>
            <div class="flex items-center gap-4">
                <p id="user-name" class="hidden sm:block text-xs font-bold"></p>
                <img id="user-img" class="w-10 h-10 rounded-full border-2 border-indigo-100">
                <button onclick="logout()" class="p-2 text-rose-500"><i data-lucide="log-out" size="20"></i></button>
            </div>
        </header>

        <main class="p-4 max-w-xl mx-auto space-y-6 mt-4">
            <div class="flex p-1.5 bg-slate-200/60 rounded-2xl">
                <button onclick="switchTab('prices')" id="btn-tab-prices" class="tab-trigger flex-1 py-3 rounded-xl font-bold text-sm bg-white shadow-sm">Precios</button>
                <button onclick="switchTab('products')" id="btn-tab-products" class="tab-trigger flex-1 py-3 rounded-xl font-bold text-sm text-slate-500">Productos</button>
                <button onclick="switchTab('config')" id="btn-tab-config" class="tab-trigger flex-1 py-3 rounded-xl font-bold text-sm text-slate-500">Config</button>
            </div>

            <section id="tab-prices" class="tab-content space-y-4">
                <div class="bg-white p-6 rounded-[2.5rem] border shadow-sm space-y-4">
                    <input id="p-prov" type="text" placeholder="Proveedor" class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-none outline-none">
                    <textarea id="p-list" rows="8" placeholder="Lista de productos..." class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-none outline-none font-mono text-sm"></textarea>
                    <button onclick="sendToWebhook('prices')" class="w-full py-5 bg-indigo-600 text-white rounded-[1.5rem] font-black shadow-xl flex items-center justify-center gap-3">
                        <i data-lucide="send" size="18"></i> Enviar Precios
                    </button>
                </div>
            </section>

            <section id="tab-products" class="tab-content hidden space-y-4">
                <div class="bg-white p-6 rounded-[2.5rem] border shadow-sm space-y-4">
                    <input id="pr-name" type="text" placeholder="Nombre del Producto" class="w-full px-6 py-4 rounded-2xl bg-slate-50 outline-none border-none">
                    <input id="pr-cost" type="number" placeholder="Precio ($)" class="w-full px-6 py-4 rounded-2xl bg-slate-50 outline-none border-none font-bold text-lg">
                    <button onclick="sendToWebhook('products')" class="w-full py-5 bg-emerald-600 text-white rounded-[1.5rem] font-black shadow-xl">Registrar Producto</button>
                </div>
            </section>

            <section id="tab-config" class="tab-content hidden space-y-4">
                <div class="bg-white p-8 rounded-[2.5rem] border shadow-sm space-y-6">
                    <h3 class="font-black text-lg italic tracking-tight">Configuración Cloud</h3>
                    <div class="space-y-4">
                        <input id="url-prices" type="url" placeholder="Webhook URL Precios" class="w-full px-6 py-4 rounded-2xl bg-slate-100 outline-none font-mono text-[10px]">
                        <input id="url-products" type="url" placeholder="Webhook URL Productos" class="w-full px-6 py-4 rounded-2xl bg-slate-100 outline-none font-mono text-[10px]">
                        <button id="btn-save" onclick="saveSettings()" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-black">Sincronizar URLs</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById('tab-' + tab).classList.remove('hidden');
            document.querySelectorAll('.tab-trigger').forEach(b => {
                b.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
                b.classList.add('text-slate-500');
            });
            const activeBtn = document.getElementById('btn-tab-' + tab);
            activeBtn.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
            activeBtn.classList.remove('text-slate-500');
        }
    </script>
</body>
</html>

